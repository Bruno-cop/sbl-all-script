--// SERVIÇOS
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer

--// CONFIG
local ESPAtivo = false
local DISTANCIA_MAX = 300

--// GUI
local gui = Instance.new("ScreenGui")
gui.Name = "MobESPMenu"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 220, 0, 130)
frame.Position = UDim2.new(0, 20, 0.35, 0)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 35)
title.Text = "MOB ESP"
title.TextColor3 = Color3.new(1,1,1)
title.BackgroundTransparency = 1
title.Font = Enum.Font.SourceSansBold
title.TextSize = 18

--// BOTÃO
local botaoESP = Instance.new("TextButton", frame)
botaoESP.Size = UDim2.new(1, -20, 0, 40)
botaoESP.Position = UDim2.new(0, 10, 0, 60)
botaoESP.Text = "ESP: OFF"
botaoESP.BackgroundColor3 = Color3.fromRGB(50,50,50)
botaoESP.TextColor3 = Color3.new(1,1,1)
botaoESP.BorderSizePixel = 0
botaoESP.Font = Enum.Font.SourceSansBold
botaoESP.TextSize = 16
Instance.new("UICorner", botaoESP).CornerRadius = UDim.new(0, 6)

botaoESP.MouseButton1Click:Connect(function()
	ESPAtivo = not ESPAtivo
	botaoESP.Text = "ESP: " .. (ESPAtivo and "ON" or "OFF")
end)

--// FUNÇÕES ESP
local function aplicarESP(model)
	local hum = model:FindFirstChildOfClass("Humanoid")
	local head = model:FindFirstChild("Head")
	if not hum or not head then return end

	-- Highlight
	if not model:FindFirstChild("MobESP") then
		local highlight = Instance.new("Highlight")
		highlight.Name = "MobESP"
		highlight.FillColor = Color3.fromRGB(255, 0, 0)
		highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
		highlight.FillTransparency = 0.5
		highlight.Parent = model
	end

	-- Nome acima da cabeça
	if not head:FindFirstChild("NameESP") then
		local billboard = Instance.new("BillboardGui")
		billboard.Name = "NameESP"
		billboard.Size = UDim2.new(0, 200, 0, 40)
		billboard.StudsOffset = Vector3.new(0, 2.5, 0)
		billboard.AlwaysOnTop = true
		billboard.Parent = head

		local text = Instance.new("TextLabel")
		text.Size = UDim2.new(1, 0, 1, 0)
		text.BackgroundTransparency = 1
		text.Text = model.Name
		text.TextColor3 = Color3.new(1,1,1)
		text.TextStrokeTransparency = 0
		text.Font = Enum.Font.SourceSansBold
		text.TextScaled = true
		text.Parent = billboard
	end
end

local function removerESP(model)
	local highlight = model:FindFirstChild("MobESP")
	if highlight then
		highlight:Destroy()
	end

	local head = model:FindFirstChild("Head")
	if head then
		local nameGui = head:FindFirstChild("NameESP")
		if nameGui then
			nameGui:Destroy()
		end
	end
end

--// LOOP
RunService.RenderStepped:Connect(function()
	local mobsFolder = workspace:FindFirstChild("WalkingNPC")
	if not mobsFolder then return end
	
	local character = player.Character
	if not character then return end
	
	local hrp = character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	for _, mob in pairs(mobsFolder:GetChildren()) do
		local mobHrp = mob:FindFirstChild("HumanoidRootPart")
		if mobHrp then
			local distancia = (mobHrp.Position - hrp.Position).Magnitude

			if ESPAtivo and distancia <= DISTANCIA_MAX then
				aplicarESP(mob)
			else
				removerESP(mob)
			end
		end
	end
end)

print("ESP com Nome carregado!")
